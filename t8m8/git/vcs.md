# バージョン管理システム

- [バージョン管理システムとは](#p1)
- [バージョン管理システムがなかったら](#p2)
- [集中型バージョン管理システム(CVCS)と分散型バージョン管理システム(DVCS)](#p3)
- [ファイルの一貫性を保つ方法](#p4)
- [ブランチ](#p5)
- [運用モデル](#p6)

---

## <a id="p1"></a> バージョン管理システムとは
- 集中型と分散型に大別される
- 変更履歴をセーブポイントのように保存していく

## <a id="p2"></a> バージョン管理システムがなかったら
- バグがあったとき
	- いつ誰がどこでどんな変更をしたらバグったのかわかりづらい
	- 前のバージョンに戻せない
- 複数人で開発をするとき
	- 共通のコードを管理するのが難しい
	- 自分の編集していないコードを誰がどう書き換えたのかわからない

## <a id="p3"></a> 集中型バージョン管理システム(CVCS)と分散型バージョン管理システム(DVCS) 

分散型バージョン管理システムが現れるまでは集中型バージョン管理システムのCVSやApache Subversion(SVN)が主流だった。  
集中型バージョン管理システムでは、1つのプロジェクトに対して1つの共有リポジトリを作成し、管理をする。  
しかし、集中型には以下のようなデメリットがあった。  

- マージのコストが高いのでブランチを切りにくい
- 他人の変更内容を上書きしてしまう
- リポジトリにアクセスできない環境ではコードの取得や変更を反映させることができない
- 何らかの障害でサーバからデータが飛んだら終わり

このようなデメリットを解決するために分散型のバージョン管理システムが登場する。  
分散型のバージョン管理システムでは、共有のリポジトリ(リモートリポジトリ)の他にユーザ個々が持つローカルリポジトリが存在する。  
gitはこの分散型バージョン管理システムに分類される。 cf. Mercurial(Hg), Bazaar, etc..  
分散型には以下のようなメリットがある。  

- pushやpull以外の操作が高速
- プロジェクトベースではなく、自分ベースでバージョンを管理できる
- 不用意に他人の変更内容を上書きすることがない
- サーバからデータが飛んでもローカル環境に残っている

また、デメリットには以下のようなものがある。

- 巨大なバイナリがあると保管に必要な容量が膨大になる
- 履歴が多くなると、ダウンロードに時間と容量がかかる

分散型バージョン管理システムはSVNとコマンド体系が違っていたので「使いづらい」とすぐには受け入れられなかった。  

## <a id="p4"></a> ファイルの一貫性を保つ方法
#### ロック
編集を行うユーザがファイルにロックをかける。編集完了まで他のユーザはそのファイルを編集できない。  
ロックされたまま放置される、1つのファイルを並行して編集ができないため効率が悪い、といった問題がある。

#### コピー&マージ
編集したいファイルをユーザのローカルにコピーして、コピーに対して編集を行う。編集完了したら、そのコピーをマージする(反映させる)。  
変更が競合したらマージ時に解決する必要がある。 

## <a id="p5"></a> ブランチ
ある状態から全く同じ状態の別の世界線を作ることをブランチを切るという。  
1つのプロジェクトに対して複数人が開発やバグ修正を行いたいときなどに、目的ごとにブランチを切って個々で作業を進める。  
ブランチを切った後は、そのブランチに他のブランチの変更が反映されることはない。  
分岐したブランチを元のブランチに合流させることをマージという。 
あるブランチとその親ブランチとの関係には、Fast-ForwardとNon Fast-Forwardの2種類が存在する。Fast-Forwardな関係とはブランチが切られてからその親ブランチが変更されていない状態のことをいう。マージ時には自動的にマージコミットというものがされるが、Fast-Forwardな場合にはマージコミットはされない(オプションでマージコミットをするように指定できる)。   
リポジトリを作成して、始めに作成されるブランチのことをmasterブランチと呼ぶ。  

(gitのページでもう少しブランチについて掘り下げる)

## <a id="p6"></a> 運用モデル
- masterブランチのみ
	- フィーチャートグルやフィーチャーフラグと呼ばれる
	- コード中にフラグを設定して機能をスイッチングする
- masterブランチ、フィーチャーブランチ
	- masterブランチは安定した状態を保つようにする
	- バグ修正・新機能の追加には、masterブランチから切られたフィーチャーブランチを使用
- masterブランチ、リリースブランチ
	- masterブランチで開発
	- リリース時にリリースブランチを切ってリリースに必要な修正をコミット
	- リリース後は修正をmasterブランチに反映させてからリリースブランチを殺す
- メインブランチ(master、develop)、サポートブランチ(フィーチャーブランチ、リリースブランチ、ホットフィックスブランチ)
	- A successful Git branching model と呼ばれる
	- 詳しくは→[参考](http://nvie.com/posts/a-successful-git-branching-model/)